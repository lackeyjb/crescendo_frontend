"use strict";angular.module("crescendoApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ui.router","ngSanitize","ngTouch","ap.lateralSlideMenu"]).config(["$httpProvider","$stateProvider","$urlRouterProvider",function(a,b,c){a.defaults.withCredentials=!0,b.state("home",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl"}).state("about",{url:"/about",templateUrl:"views/about.html",controller:"AboutCtrl"}).state("game1",{url:"/game1",templateUrl:"views/game1.html",controller:"Game1Ctrl",onEnter:["$state","AuthService",function(a,b){b.isAuthenticated()||a.go("home")}]}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"AuthCtrl"}).state("register",{url:"/register",templateUrl:"views/register.html",controller:"AuthCtrl"}),c.otherwise("/")}]).service("number",function(){return{isPositive:function(a){return-1===String(a).indexOf("-")}}}),angular.module("crescendoApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("crescendoApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("crescendoApp").controller("AuthCtrl",["$scope","$rootScope","AuthService",function(a,b,c){a.register=function(){c.register(a.user).success(function(a){b.$emit("auth:new-registration",a)}).error(function(){alert("Something went wrong, please try again.")})},a.login=function(){c.login(a.session).success(function(a){b.$emit("auth:login",a)}).error(function(){alert("Something went wrong, please try again."),a.session={}})}}]),angular.module("crescendoApp").controller("NavCtrl",["$scope","$rootScope","$state","$browser","AuthService",function(a,b,c,d,e){a.tabs=[{state:"home",label:"Home",active:!0,isPublic:!0},{state:"about",label:"About",active:!0,isPublic:!0}],a.getTabClass=function(a){return a.active?"active":""},a.$on("$stateChangeSuccess",function(){a.tabs.forEach(function(a){a.active=c.is(a.state)})}),a.isAuthenticated=function(){return!!a.user},a.showTab=function(b){return b.isPublic||a.isAuthenticated()},e.getSession().success(function(b){a.user=b}),a.logout=function(){e.logout().success(function(){b.$emit("auth:logout")})},b.$on("auth:new-registration",function(b,d){a.user=d,c.go("home")}),b.$on("auth:login",function(b,d){a.user=d,c.go("home")}),b.$on("auth:logout",function(){a.user=null,c.go("home")})}]),angular.module("crescendoApp").controller("Game1Ctrl",["$state",function(a){var b=new Phaser.Game(640,480,Phaser.AUTO,"gameview"),c=function(){this.player=null,this.platforms=null,this.sky=null,this.bubbles=null,this.score=0,this.increaseScoreBy=10,this.scoreText=0,this.lives=3,this.livesText=3,this.facing="left",this.edgeTimer=0,this.jumpTimer=0,this.wasStanding=!1,this.cursors=null,this.gameBubbleCollection=[],this.cMajorScale=["bubbleC","bubbleD","bubbleE","bubbleF","bubbleG","bubbleF","bubbleA","bubbleB"]};c.prototype={init:function(){this.world.resize(640,2e3),this.physics.startSystem(Phaser.Physics.ARCADE),this.physics.arcade.gravity.y=750,this.physics.arcade.skipQuadtree=!1},preload:function(){this.load.image("trees","images/trees.png"),this.load.image("clouds","images/clouds.png"),this.load.image("bubbleA","images/a-bubble.png"),this.load.image("bubbleAsh","images/a-sh-bubble.png"),this.load.image("bubbleB","images/b-bubble.png"),this.load.image("bubbleC","images/c-bubble.png"),this.load.image("bubbleCsh","images/c-sh-bubble.png"),this.load.image("bubbleD","images/d-bubble.png"),this.load.image("bubbleDsh","images/d-sh-bubble.png"),this.load.image("bubbleE","images/e-bubble.png"),this.load.image("bubbleF","images/f-bubble.png"),this.load.image("bubbleFsh","images/f-sh-bubble.png"),this.load.image("bubbleG","images/g-bubble.png"),this.load.image("bubbleGsh","images/g-sh-bubble.png"),this.load.image("platform","images/moving_platform.png"),this.load.image("ice-platform","images/ice-platform.png"),this.load.spritesheet("dude","images/crescendodude.png",49.6,68)},create:function(){this.stage.backgroundColor="#2f9acc",this.sky=this.add.tileSprite(0,0,640,480,"clouds"),this.sky.fixedToCamera=!0,this.add.sprite(0,1906,"trees"),this.platforms=this.add.physicsGroup();for(var a=0,c=64,d=0;19>d;d++){var e=d%2===1?"platform":"ice-platform",f=this.platforms.create(a,c,e);f.body.velocity.x=this.rnd.between(100,150),Math.random()>.5&&(f.body.velocity.x*=-1),a+=200,a>=600&&(a=0),c+=104}this.platforms.setAll("body.allowGravity",!1),this.platforms.setAll("body.immovable",!0),this.player=this.add.sprite(320,1952,"dude"),this.physics.arcade.enable(this.player),this.player.body.collideWorldBounds=!0,this.player.body.setSize(45,52,0,16),this.player.animations.add("left",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],30,!0),this.player.animations.add("right",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],30,!0),this.camera.follow(this.player),this.bubbleSpawn(),this.scoreText=b.add.text(16,16,"score: 0",{fontSize:"32px",fill:"#000"}),this.livesText=b.add.text(100,40,"lives: 3",{fontSize:"32px",fill:"#000"}),this.cursors=this.input.keyboard.createCursorKeys(),this.jump=this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR)},wrapPlatform:function(a){a.body.velocity.x<0&&a.x<=-160?a.x=640:a.body.velocity.x>0&&a.x>=640&&(a.x=-160)},setFriction:function(a,b){"ice-platform"===b.key&&(a.body.x-=b.body.x-b.body.prev.x)},update:function(){this.sky.tilePosition.y=-(.7*this.camera.y),this.platforms.forEach(this.wrapPlatform,this),this.physics.arcade.collide(this.player,this.platforms,this.setFriction,null,this),this.physics.arcade.collide(this.bubbles,this.platforms),this.physics.arcade.collide(this.bubbles);var b=120-this.badNotesArray().length*this.increaseScoreBy;this.lives>0&&this.score<b?this.physics.arcade.overlap(this.player,this.bubbles,this.collectBubble,null,this):a.go("home");var c=this.player.body.blocked.down||this.player.body.touching.down;this.scoreText.x=this.camera.x,this.scoreText.y=this.camera.y,this.livesText.x=this.camera.x,this.livesText.y=this.camera.y+30,this.player.body.velocity.x=0,this.cursors.left.isDown?(this.player.body.velocity.x=-200,"left"!==this.facing&&(this.player.anchor.setTo(.5,0),this.player.scale.x=-1,this.player.play("left"),this.facing="left")):this.cursors.right.isDown?(this.player.body.velocity.x=200,"right"!==this.facing&&(this.player.scale.x=1,this.player.play("right"),this.facing="right")):"idle"!==this.facing&&(this.player.animations.stop(),this.player.frame="left"===this.facing?0:5,this.facing="idle"),!c&&this.wasStanding&&(this.edgeTimer=this.time.time+250),(c||this.time.time<=this.edgeTimer)&&(this.cursors.up.isDown||this.jump.isDown)&&this.time.time>this.jumpTimer&&(this.player.body.velocity.y=-500,this.jumpTimer=this.time.time+750),this.wasStanding=c},bubbleRandomizer:function(){return _.sample(["bubbleA","bubbleAsh","bubbleB","bubbleC","bubbleCsh","bubbleD","bubbleDsh","bubbleE","bubbleF","bubbleFsh","bubbleG","bubbleGsh"])},bubbleSpawn:function(){var a=this;a.bubbles=b.add.group(),a.bubbles.enableBody=!0;for(var c=0;12>c;c++){var d=a.bubbles.create(70*c,a.camera.screenView.height+1e3,a.bubbleRandomizer());this.gameBubbleCollection.push(d),d.body.bounce.y=.9+.2*Math.random(),d.body.collideWorldBounds=!0,d.body.gravity.y=Math.floor(-200*Math.random()+-600)}},collectBubble:function(a,b){b.kill(),_.contains(this.cMajorScale,b.key.toString())?(this.score+=this.increaseScoreBy,this.scoreText.text="Score: "+this.score):(this.lives-=1,this.livesText.text="Lives: "+this.lives)},badNotesArray:function(){var a=_.map(this.gameBubbleCollection,function(a){return a.key.toString()});return _.difference(a,this.cMajorScale)}},b.state.add("Game",c,!0)}]),angular.module("crescendoApp").service("AuthService",["$http",function(a){var b=this;b.currentUser=null,b.isAuthenticated=function(){return!!b.currentUser},b.getSession=function(){var c=a.get("/api/sessions/");return c.success(function(a){console.log("getSession returned user = "+JSON.stringify(a)),b.currentUser=a}),c},b.getSession(),b.register=function(c){var d=a.post("/api/users/",{user:c});return d.success(function(a){b.currentUser=a}),d},b.login=function(c){var d=a.post("/api/sessions/",{session:c});return d.success(function(a){b.currentUser=a}),d},b.logout=function(){var c=a["delete"]("/api/sessions/");return c.success(function(){b.currentUser=null}),c}}]),function(){var a=angular.module("ap.lateralSlideMenu",[]);a.constant("menuConfig",{openClass:"lateral-slide-menu-is-open",inTransitionClass:"lateral-slide-menu-in-transition"}),a.service("menuService",["$document",function(a){var b=null;this.open=function(e){b||(a.bind("click",c),a.bind("keydown",d)),b&&b!==e&&(b.isOpen=!1),b=e},this.close=function(e){b===e&&(b=null,a.unbind("click",c),a.unbind("keydown",d))};var c=function(a){},d=function(a){27===a.which&&(b.focusToggleElement(),c())}}]),a.controller("MenuController",["$scope","$attrs","$parse","menuConfig","menuService","$timeout","$animate","$window",function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n=this,o=a.$new(),p=d.openClass,q=d.inTransitionClass,r=angular.noop,s=b.onToggle?c(b.onToggle):angular.noop,t="";void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend?(t="-webkit-",j="WebkitTransition",k="webkitTransitionEnd transitionend"):(j="transition",k="transitionend"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend?(t="-webkit-",l="WebkitAnimation",m="webkitAnimationEnd animationend"):(l="animation",m="animationend");var u="Duration",v="Delay",w="IterationCount",x=function(a){var b=null;if(!b){var c=0,d=0,e=0,f=0;angular.forEach(a,function(a){if(1===a.nodeType){var b=h.getComputedStyle(a)||{},g=b[j+u];c=Math.max(y(g),c);var i=b[j+v];d=Math.max(y(i),d);{b[l+v]}f=Math.max(y(b[l+v]),f);var k=y(b[l+u]);k>0&&(k*=parseInt(b[l+w],10)||1),e=Math.max(k,e)}}),b={total:0,transitionDelay:d,transitionDuration:c,animationDelay:f,animationDuration:e}}return b},y=function(a){var b=0,c=angular.isString(a)?a.split(/\s*,\s*/):[];return angular.forEach(c,function(a){b=Math.max(parseFloat(a)||0,b)}),b};this.init=function(d){n.$element=d,n.page=angular.element(document.getElementsByClassName("lateral-slide-menu-main-page")),b.isOpen&&(i=c(b.isOpen),r=i.assign,a.$watch(i,function(a){o.isOpen=!!a}))},this.toggle=function(a){return o.isOpen=arguments.length?!!a:!o.isOpen,o.isOpen},this.isOpen=function(){return o.isOpen},o.getToggleElement=function(){return n.toggleElement},o.focusToggleElement=function(){n.toggleElement&&n.toggleElement[0].focus()},o.$watch("isOpen",function(b,c){if(b)n.$element.addClass(p),n.$element.addClass(q),o.focusToggleElement(),e.open(o);else{n.$element.removeClass(p);var d=x(n.page),g=Math.max(d.transitionDuration,d.animationDuration);f(function(){n.$element.removeClass(q)},1e3*g),e.close(o)}r(a,b),angular.isDefined(b)&&b!==c&&s(a,{open:!!b})}),a.$on("$locationChangeSuccess",function(){o.isOpen=!1}),a.$on("$destroy",function(){o.$destroy()})}]),a.directive("lateralSlideMenuController",function(){return{controller:"MenuController",restrict:"AE",link:function(a,b,c,d){d.init(b)}}}),a.directive("lateralSlideMenu",function(){return{require:"^lateralSlideMenuController",restrict:"AE",transclude:!0,template:'<nav class="lateral-slide-menu"><div class="lateral-slide-menu-scrollable-container" ng-transclude></div></nav><div class="lateral-slide-menu-overlay" lateral-slide-menu-toggle></div>'}}),a.directive("lateralSlideMenuToggle",function(){return{require:"^lateralSlideMenuController",restrict:"AE",link:function(a,b,c,d){if(d){d.toggleElement=b;var e=function(e){e.preventDefault(),b.hasClass("disabled")||c.disabled||a.$apply(function(){d.toggle()})};b.bind("click",e),b.addClass("lateral-slide-menu-toggle"),b.attr({"aria-expanded":!1}),a.$watch(d.isOpen,function(a){b.attr("aria-expanded",!!a)}),a.$on("$destroy",function(){b.unbind("click",e)})}}}})}();