"use strict";angular.module("crescendoApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ui.router","ngSanitize","ngTouch"]).config(["$httpProvider","$stateProvider","$urlRouterProvider",function(a,b,c){a.defaults.withCredentials=!0,b.state("home",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl"}).state("about",{url:"/about",templateUrl:"views/about.html",controller:"AboutCtrl"}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"AuthCtrl"}).state("register",{url:"/register",templateUrl:"views/register.html",controller:"AuthCtrl"}),c.otherwise("/")}]),angular.module("crescendoApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("crescendoApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("crescendoApp").controller("AuthCtrl",["$scope","$rootScope","AuthService",function(a,b,c){a.register=function(){c.register(a.user).success(function(a){b.$emit("auth:new-registration",a)}).error(function(){alert("Something went wrong, please try again.")})},a.login=function(){c.login(a.session).success(function(a){b.$emit("auth:login",a)}).error(function(){alert("Something went wrong, please try again."),a.session={}})}}]),angular.module("crescendoApp").controller("NavCtrl",["$scope","$rootScope","$state","$browser","AuthService",function(a,b,c,d,e){a.tabs=[{state:"home",label:"home",active:!0,isPublic:!0},{state:"about",label:"about",active:!0,isPublic:!0}],a.getTabClass=function(a){return a.active?"active":""},a.$on("$stateChangeSuccess",function(){a.tabs.forEach(function(a){a.active=c.is(a.state)})}),a.isAuthenticated=function(){return!!a.user},a.showTab=function(b){return b.isPublic||a.isAuthenticated()},e.getSession().success(function(b){a.user=b}),a.logout=function(){e.logout().success(function(){b.$emit("auth:logout")})},b.$on("auth:new-registration",function(b,d){a.user=d,c.go("home")}),b.$on("auth:login",function(b,d){a.user=d,c.go("home")}),b.$on("auth:logout",function(){a.user=null,c.go("home")})}]),angular.module("crescendoApp").service("AuthService",["$http",function(a){var b=this;b.currentUser=null,b.isAuthenticated=function(){return!!b.currentUser},b.getSession=function(){var c=a.get("/api/sessions/");return c.success(function(a){console.log("getSession returned user = "+JSON.stringify(a)),b.currentUser=a}),c},b.getSession(),b.register=function(c){var d=a.post("/api/users/",{user:c});return d.success(function(a){b.currentUser=a}),d},b.login=function(c){var d=a.post("/api/sessions/",{session:c});return d.success(function(a){b.currentUser=a}),d},b.logout=function(){var c=a["delete"]("/api/sessions/");return c.success(function(){b.currentUser=null}),c}}]);